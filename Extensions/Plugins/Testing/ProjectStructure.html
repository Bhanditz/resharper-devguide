


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/resharper/devguide/app/css/styles.min.css">

    <!-- non-retina iPad pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-72x72.png" sizes="72x72">

    <!-- retina iPhone pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-114x114.png" sizes="114x114">

    <!-- retina iPad pre iOS 7 -->
    <link rel="apple-touch-icon" href="/resharper/devguide/apple-touch-icon-144x144.png" sizes="144x144">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/resharper/devguide/apple-touch-icon-precomposed.png">

    <!-- normal favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/resharper/devguide/favicon.ico">
    <link rel="icon" type="image/png" href="/resharper/devguide/favicon.png">
<link  rel="stylesheet" href="/resharper/devguide/styles/styles.css"></head>
<body data-id="Extensions/Plugins/Testing/ProjectStructure">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="https://youtrack.jetbrains.com/issues/IJSDK">Send feedback</a></p>
                <p>&copy; 2000&ndash;2015 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
        <div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1">
            <option data-group="primary" value="default" selected>Default</option>
            <option data-group="primary" value="default_for_gnome">GNOME</option>
            <option data-group="primary" value="default_for_kde">KDE</option>
            <option data-group="primary" value="default_for_xwin">XWindow</option>
            <option data-group="primary" value="emacs">Emacs</option>
            <option data-group="primary" value="jbuilder">JBuilder</option>
            <option data-group="primary" value="visual_studio">Visual Studio</option>
            <option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option>
            <option data-group="primary" value="eclipse">Eclipse</option>
            <option data-group="secondary" value="mac_os_x_10.5_">OS X 10.5+</option>
            <option data-group="secondary" value="mac_os_x">OS X</option>
            <option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option></select>
        </div>
    
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">

                    
                    <a name="test-project-structure" class="elem-anchor"></a>
<h1>Test Project Structure<a href="#test-project-structure" class="anchor-link"><span></span></a></h1>

<p>A test project is an <a href="http://nunit.org" data-bypass="yes"><span>NUnit</span></a> based Class Library project, that targets .Net 4.0 and includes a reference to the main plugin project (ReSharper is a .net 4.0 application in order to support Visual Studio 2010 and above).</p>

<p>The test project should also include a reference to the <code class="code highlight language-text">JetBrains.ReSharper.SDK.Tests</code> NuGet package. This package takes a dependency on the <code class="code highlight language-text">JetBrains.ReSharper.SDK</code> package, as well as the <code class="code highlight language-text">NUnit</code> package. The <code class="code highlight language-text">SDK.Tests</code> package will ensure that all files required to run the plugin are copied to the output directory. This includes reference assemblies, but also content files, such as external annotations and CSS definition files.</p>

<aside class="note">
  <p> The normal SDK package does not copy these files, as the plugin cannot be run outside of the context of ReSharper, as installed in Visual Studio. For manual testing, the plugin should be <a href="/resharper/devguide/Extensions/Plugins/ProjectSetup/InitialInstallation.html"><span>initially installed</span></a> and then <a href="/resharper/devguide/Extensions/Plugins/ProjectSetup/CopyOnBuild.html"><span>copied to the installation folder on each build</span></a>.</p>
</aside>

<aside class="note">
  <p> ReSharper 9.0 did not publish a <code class="code highlight language-text">JetBrains.ReSharper.SDK.Tests</code> package, primarily because the SDK contained all assemblies, including the test framework, and it would copy all files to the output folder, both for production builds and test builds. This left little else for the Tests package to do, so it was not released. In order to write tests for a 9.0 plugin, you would include <code class="code highlight language-text">JetBrains.ReSharper.SDK</code> directly in the test project.</p>
</aside>

<p>The standard project layout for a ReSharper project with tests is as follows:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_text">+-- src\
|   +-- {plugin}.sln
|   +-- plugin\
|       +-- {plugin}.csproj
+-- test\
    +-- data\
        +-- nuget.config
        +-- ...
    +-- src\
        +-- {tests}.csproj
        +-- TestEnvironment.cs
        +-- ...</code></pre>

<p>Where <code class="code highlight language-text">{plugin}</code> is the name of your plugin solution and project and <code class="code highlight language-text">{tests}</code> is the name of your tests project. The main plugin solution includes the plugin project and the tests project.</p>

<p>The <code class="code highlight language-text">TestEnvironment.cs</code> file contains the bootstrap code for the test environment. This is detailed in the <a href="TestEnvironment.html"><span>Test Environment</span></a> section.</p>

<a name="test-data-folder" class="elem-anchor"></a>
<h2>Test data folder<a href="#test-data-folder" class="anchor-link"><span></span></a></h2>

<p>The <code class="code highlight language-text">test\data</code> folder contains sub-folders that in turn contain the data files for the functional tests defined in the tests project. These files are typically source files, as well as <code class="code highlight language-text">.gold</code> files that contain the text output of the test. If the actual output of a test is different to the <code class="code highlight language-text">.gold</code> file, the test fails.</p>

<a name="nugetconfig" class="elem-anchor"></a>
<h2>NuGet.config<a href="#nugetconfig" class="anchor-link"><span></span></a></h2>

<p>The <code class="code highlight language-text">test\data</code> folder also needs to contain a <code class="code highlight language-text">nuget.config</code> file. When ReSharper runs tests, it creates an in-memory project, which will target a particular version of the .Net framework. To make tests repeatable on any machine, the ReSharper test framework will download NuGet packages that represent each version of the .Net framework. This prevents the need for having all versions of .Net installed in the GAC of the local machine. However, these NuGet packages are not intended to be referenced in normal projects, and so are not hosted on nuget.org, but are hosted on JetBrains infrastructure. In order to download these files for your plugin tests, you will need to create a <code class="code highlight language-text">nuget.config</code> file in the root of your <code class="code highlight language-text">data</code> folder. The file should look like this:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;config&gt;</span>
    <span class="c">&lt;!-- See https://docs.nuget.org/consume/nuget-config-file for config options --&gt;</span>
  <span class="nt">&lt;/config&gt;</span>
  <span class="nt">&lt;packageSources&gt;</span>
    <span class="c">&lt;!-- Clear any existing package sources --&gt;</span>
    <span class="nt">&lt;clear</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Add the JetBrains test package gallery first.</span>
<span class="c">         Then include nuget.org to download non-test packages to include in test projects --&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;jb-gallery&quot;</span> <span class="na">value=</span><span class="s">&quot;http://jb-gallery.azurewebsites.net/api/v2/curated-feeds/TestNuggets/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;nuget.org&quot;</span> <span class="na">value=</span><span class="s">&quot;http://www.nuget.org/api/v2/&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/packageSources&gt;</span>
  <span class="nt">&lt;disabledPackageSources&gt;</span>
    <span class="nt">&lt;clear</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/disabledPackageSources&gt;</span>
  <span class="nt">&lt;packageRestore&gt;</span>
    <span class="c">&lt;!-- Allow NuGet to download missing packages --&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;enabled&quot;</span> <span class="na">value=</span><span class="s">&quot;True&quot;</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Automatically check for missing packages during build in Visual Studio --&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;automatic&quot;</span> <span class="na">value=</span><span class="s">&quot;False&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/packageRestore&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>

<p>The test packages are automatically restored the first time the tests are run, and are saved by default to the <code class="code highlight language-text">Packages</code> folder in the root of the project structure (i.e. the <code class="code highlight language-text">Packages</code> folder is alongside the <code class="code highlight language-text">src</code> and <code class="code highlight language-text">tests</code> folder in the above example - see below for details on how the project root is found, and how to customise the project structure).</p>

<p>The <code class="code highlight language-text">repositoryPath</code> config setting can be used to override the default location of the saved test packages. This is useful if you wish to share the packages between multiple plugins (the test packages are rather large). E.g.:</p>

<pre><code class="code-block__wrapper code-block _highlighted lang_xml"><span class="c">&lt;!-- ... [snip] ... --&gt;</span>
<span class="nt">&lt;config&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;repositorypath&quot;</span> <span class="na">value=</span><span class="s">&quot;C:\JetTestPackages&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/config&gt;</span>
<span class="c">&lt;!-- ... [snip] ... --&gt;</span></code></pre>

<p>This path can be local to the current directory (usually the location of the assembly containing the derived <code class="code highlight language-text">ExtensionTestEnvrionmentAssembly</code> class), or fully qualified, and shared across multiple solutions. However, remember that using a fully qualified path may not be the best solution for an open source project, as it requires anyone forking your project to put the files in the same location.</p>

<a name="customising-the-project-structure" class="elem-anchor"></a>
<h2>Customising the project structure<a href="#customising-the-project-structure" class="anchor-link"><span></span></a></h2>

<p>It is recommended that plugins use the standard project structure described above - the test framework will not require any further configuration. However, it is possible to use a different project structure, should this be necessary. The test framework will need to be told how to find the project root, and how to find the test data folder.</p>

<p>When trying to find the project root, the test framework will first try to use the <code class="code highlight language-text">JetProductHomeDir</code> environment variable. This is not recommended, as it requires changing for each plugin you would need to build.</p>

<p>If the environment variable isn’t set, the test framework will then look for an empty marker file called <code class="code highlight language-text">Product.Root</code> in a folder above the current location of the assembly that contains the derived <code class="code highlight language-text">ExtensionTestEnvironmentAssembly</code> class (e.g. <code class="code highlight language-text">bin\Debug</code> of the test project). This is the method used when building the ReSharper Platform and products, which needs explicit markers to help with the build system.</p>

<p>If the marker file isn’t found, the test framework finally looks for an assembly level attribute that specifies the relative path from the project root to the test data path (the location that contains the <a href="GoldFiles.html"><span><code class="code highlight language-text">.gold</code> files</span></a>). E.g. <code class="code highlight language-text">[assembly: TestDataPathBase(&quot;test\myData&quot;)]</code>. If no attribute exists, the default relative path of <code class="code highlight language-text">test\data</code> is used. (Note that the attribute is marked as obsolete, but is still supported. It is recommended to stick to the default project structure.)</p>

<p>The test framework will use the relative path to try to find the project root, by checking to see if the relative path is valid at each parent folder above the current location of the assembly that contains the derived <code class="code highlight language-text">ExtensionTestEnvironmentAssembly</code> class. Once it finds the project root, it sets the <code class="code highlight language-text">JetProductHomeDir</code> environment variable in the current process (the marker file method does not set the environment variable, as the project root can be easily found by looking for the marker file again).</p>

<p>Plugins are recommended to follow the standard project structure described above. If the project structure is different, it is recommended to use a <code class="code highlight language-text">test\data</code> folder, and if that is not possible, to use the <code class="code highlight language-text">[TestDataPathBase]</code> attribute.</p>


                    <div class="last-modified">
                        Last modified: 12 August 2015
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>


<script data-main="/resharper/devguide/app/js/main.build" data-baseurl="/resharper/devguide/" src="/resharper/devguide/app/js/vendor/requirejs/require.js"></script>

</body>
</html>

